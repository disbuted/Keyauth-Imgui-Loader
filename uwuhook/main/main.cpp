//⠄⠄⠄⠄⠄⠄⠄⠄⢀⣀⣀⣶⣿⢟⣵⣿⣿⣿⣿⣿⢿⣿⣿⣿⣿⣿⣿⣿⣿⡿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣶⣙⣷⣶⣶⣤⣄⣀⣀⠄⠄⠄⠄⠄⠄
//⠄⠄⠄⢀⣤⣶⣶⣿⣿⠿⠿⠛⢫⣿⣿⣿⣿⣿⡟⣱⣿⣿⢿⣿⣿⣿⣿⣿⣿⡇⣿⣿⣿⣿⣿⣿⣿⣿⣷⠻⣿⣿⣿⣿⣿⣿⣿⠈⠉⠉⠙⠛⠻⢿⣿⣶⣶⣤⡀⠄
//⢠⣼⣿⡿⠛⠛⠁⠄⠄⠄⠄⣴⣿⣿⣿⣿⣿⣏⣼⣿⣿⢣⣿⣿⣿⣿⣿⣿⣿⣷⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⡙⢿⣿⣿⣿⣿⣿⠄⠄⠄⠄⠄⠄⠄⠄⠄⠙⠛⠻⣿
//⣿⣟⠁⠄⠄⠄⠄⠄⠄⢀⣼⣿⣿⣿⣿⣿⢧⣾⣿⣿⡟⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⡞⢿⣿⣿⣿⣿⣧⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⠄⢠
//⢸⣿⡄⠄⠄⠄⠄⠄⢀⣼⣿⣿⣿⣿⣿⢧⣾⢻⣿⣿⢁⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⡞⢿⣿⣿⣿⣿⡄⠄⠄⠄⠄⠄⠄⠄⠄⠄⢀⣼
//⠘⣿⣷⠄⠄⠄⠄⠄⣼⣿⣿⣿⣿⣿⢏⣼⣇⣿⣿⣿⢸⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⢸⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⡼⣿⣿⣿⣿⣿⡀⠄⠄⠄⠄⠄⠄⠄⢀⣼⡏
//⠄⢸⣿⣆⠄⠄⠄⣸⣿⣿⣿⣿⣿⡿⣼⣿⢹⣿⣿⣿⢸⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣾⣿⣿⣿⡿⣿⣿⣿⣿⣿⣿⣷⢹⣿⣿⣿⣿⣷⡄⠄⠄⠄⠄⠄⢀⣾⡟⠄
//⠄⠄⠹⣿⣄⠄⣰⣿⣏⣿⣿⣿⣿⠁⣿⣿⢸⣿⣿⣿⠄⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⡏⢿⣿⣿⣷⠹⣿⣿⣿⣿⣿⣿⡉⣿⣿⣿⣿⣿⣷⣆⠄⠄⠄⣀⣾⠋⠄⠄
//⠄⠄⠄⣿⣿⢄⣿⣿⢿⣿⣿⣿⡿⢸⣿⡿⢸⣿⣿⣿⢚⠹⣿⢿⣿⣿⣿⢻⣿⣿⣿⣿⡇⠸⣿⣿⣿⡄⠙⣿⣿⣹⣿⣿⡇⢸⣿⣿⣿⣿⡿⣿⡆⡀⠄⣿⡏⠄⠄⠄
//⠄⠄⣠⣿⡟⣼⣿⣿⢸⣿⣿⣿⠇⢸⡿⣳⣧⣻⣿⣿⢻⣷⣝⢦⢻⣿⣿⡞⠻⣿⣿⣿⣿⣴⣜⢿⣿⣧⢿⣮⡻⠏⣿⣿⢷⡆⣿⣿⣿⣿⡇⣿⣿⡜⣿⡹⣧⠄⠄⠄
//⠄⢸⣿⡿⢠⣿⣿⣿⢸⣿⣿⣿⠄⢘⣾⣿⣿⣷⣜⡛⠘⣿⣿⣷⣦⣜⢻⣿⣦⢬⡛⢿⣿⣧⢻⣷⣬⣛⠦⢿⣿⡇⣿⢯⡼⣧⣿⣿⣿⣿⡇⣿⣿⣿⢻⣷⢿⡄⠄⠄           ⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿
//⢠⣿⣿⡁⣾⣿⣿⣿⢸⣿⣿⣿⣤⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣶⣬⣵⣽⣿⣶⣬⣥⣿⣿⣿⣿⣿⣿⣇⣷⣿⣿⣦⣿⣿⣿⣿⢿⣿⣿⣿⣆⣿⡌⣿⡄⠄           ⣿  uwuhook dev release    ⣿
//⣼⣿⢇⢃⣿⣿⣿⣿⡿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⠿⠿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⡿⠿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⡿⣸⣿⣿⣿⣿⢹⣿⢻⣇⠄           ⣿    all made by me       ⣿
//⣿⣏⣾⣸⣿⣿⣿⣿⡇⢿⣿⡿⣿⣿⣿⠿⠿⠿⠿⠿⠿⠷⢶⣭⣽⣿⣿⣿⣿⣿⣿⣿⣿⣯⡵⢾⠛⠛⠉⠉⠉⠛⣛⡿⢿⣿⣿⣿⣿⢡⣿⣿⣿⣿⣿⡆⣿⣆⢿⡆           ⣿   if you got this src   ⣿
//⡿⢹⡏⣿⣿⣿⣿⣿⣿⡼⣿⡇⠿⢋⣒⣚⣃⣀⣀⣀⣀⣀⣀⣈⣉⣹⣿⣿⣿⣿⣿⣿⣯⣡⣤⣭⣤⣤⣴⣦⣤⣤⣭⣭⣅⣈⣿⣿⡟⣾⣿⣿⣿⣿⠏⣿⢳⠻⣾⣧           ⣿   it either got leaked  ⣿
//⣇⣿⠁⣿⢿⣿⣿⣿⣿⣧⢹⣷⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⢻⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⡿⣿⣿⣴⣿⣿⣿⣿⡟⣾⣿⡈⣷⡁⣿           ⣿   it i selfleaked it    ⣿
//⢻⣿⢸⣿⡌⣿⣿⣿⣿⣿⣧⢿⢿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⠇⣿⢋⣿⣿⣿⣿⢯⣼⣿⣿⣇⣿⣧⢻           ⣿ ----------------------  ⣿
//⢸⡇⢸⣿⣿⠹⣿⣿⣿⣿⣿⣦⢸⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⡟⣼⠟⣾⣿⣿⡿⢣⣾⣿⣿⣿⣿⣿⣿⣏           ⣿  https://e-z.bio/%C2%A3 ⣿
//⣿⡇⢸⣿⣿⣷⡙⢿⣿⣿⣿⣿⣦⢻⣿⣿⣿⣿⣿⣿⣿⠿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⠿⢻⣿⣿⣿⣿⣿⣿⣿⢳⢛⣾⣿⣿⢛⣼⣿⣿⣿⣿⣿⣿⣿⣿⣿           ⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿
//⣿⡇⠘⣿⣿⣿⣿⣏⡻⣿⣿⣿⣿⣧⠻⣿⣿⣿⣿⣿⣿⣿⣤⣲⠶⢶⣶⣶⣶⣶⣶⣶⡶⢿⣫⣼⣿⣿⣿⣿⣿⣿⣿⠇⣳⣿⣿⢟⣴⣿⣿⣿⣿⣿⣿⣿⣿⣿⣻⣿
//⣿⣿⠄⠻⣿⣿⣿⣿⣷⣎⣛⢿⣿⣿⣷⡽⢿⣿⣿⣿⣿⣿⣿⣿⣿⣶⣶⣶⣶⣶⣶⣶⣾⣿⣿⣿⣿⣿⣿⣿⣿⣿⢏⣰⡿⣋⣶⣿⣿⣿⣿⣿⣿⣿⣿⣿⠏⣿⡏⢿
//⢹⣿⠄⠄⠻⣿⣿⣿⣿⣿⣿⣶⣍⣻⢿⣿⣎⢿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⠿⠿⢋⢞⣫⣾⣿⣿⣿⣿⣿⣿⣿⣿⣿⡿⠋⢀⣿⡷⠘
//⣸⡏⠄⠄⠄⠙⣿⣿⣿⣿⣿⣿⣿⣿⣶⣮⣍⡣⠄⠉⠉⠙⠛⠿⠿⣿⣿⣿⣿⣿⣿⣿⡿⠿⠟⠋⠉⠉⠁⠄⠄⣰⣾⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⡿⠁⠄⣾⣿⡇⠄
//⡟⣿⠄⠄⠄⠄⠈⠻⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣷⣤⠄⠄⠄⠄⡀⣤⣤⣀⣀⡀⠄⣀⣀⣠⣤⣴⣿⠃⣦⠄⣾⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⡟⠃⠄⠄⣴⣿⣿⠃⠄
//⣿⡜⡆⠄⠘⣄⠄⠄⠄⠙⠻⣿⣿⣿⣿⣿⣿⣿⣿⣿⣧⠄⠄⣼⣦⡝⢿⣿⣿⣿⣿⣿⣿⡿⢟⣣⣶⣿⣿⣼⣿⣿⣿⣿⣿⣿⣿⡿⠟⠛⠁⠄⠄⠄⣴⣿⣿⢣⡆⠄
//⢻⣿⣦⡀⠄⣿⣧⡄⠄⠄⠄⠄⠉⠛⠻⠿⣿⣿⣿⣿⣿⣷⠺⣿⣿⣿⣷⣜⡛⣿⡿⢛⣥⣾⣿⣿⣿⣿⡇⣿⣿⣿⠟⠛⠋⠄⠄⠄⠄⠄⠄⢀⣰⣿⣿⣿⣫⣿⣧⣴
//⠄⠘⠿⣿⣶⣼⣿⢿⣷⣄⣀⠄⠄⠄⠄⠄⠄⠄⠈⠉⠛⠿⣧⣿⣿⣿⣿⡿⢿⣠⣘⡿⢿⣿⣿⣿⣿⠿⡇⡿⠋⠄⠄⠄⠄⣀⣀⣀⣤⣴⣾⣿⡿⠿⣋⣾⠿⠛⠛⠋  
//⠄⠄⠄⠈⠉⠉⠄⠄⠉⠻⠿⣷⣶⣤⣀⣀⣀⣀⣀⣀⣀⣀⡈⢸⣯⣽⣷⡾⠿⠟⠿⢿⣷⣶⣶⣶⣶⣿⡇⣀⣀⣀⣐⣚⣛⣿⣿⣿⣛⣛⣩⣽⣶⠿⠟⠉⠄⠄⠄⠄

#include "main.hpp"
#include "../protection/obfusheader/obfusheader.h"
#include "../libs/xor/xorstr.hpp"

c_main gui;

int main(int, char**) {

    PlaySoundA(reinterpret_cast<LPCSTR>(wavData), NULL, SND_MEMORY | SND_ASYNC | SND_NODEFAULT);
	Sleep(4000);
    
    VMProtectBeginUltra("main");
    Beep(500, 500);


    auto wndClassName = xorstr(L"dmwhgckrakyzkopfccjbxgzwlplrzftp");
    auto wndTitle = xorstr(L"dmwhgckrakyzkopfccjbxgzwlplrzftp");

    WNDCLASSEXW wc = { sizeof(wc), CS_CLASSDC, WndProc, 0L, 0L, GetModuleHandle(NULL), NULL, NULL, NULL, NULL, wndClassName.crypt_get(), NULL };

    ::RegisterClassExW(&wc);

    HWND hwnd = ::CreateWindowW(wc.lpszClassName, wndTitle.crypt_get(), WS_POPUP,
        static_cast<int>(GetSystemMetrics(SM_CXSCREEN) / 2 - ui::size.x / 2),
        static_cast<int>(GetSystemMetrics(SM_CYSCREEN) / 2 - ui::size.y / 2),
        static_cast<int>(ui::size.x),
        static_cast<int>(ui::size.y),
        NULL, NULL, wc.hInstance, NULL);


    IMGUI_CHECKVERSION();
    ImGui::CreateContext();
    ImGuiIO& io = ImGui::GetIO();
    io.IniFilename = nullptr;

    CreateDeviceD3D(hwnd);
    {
        ImGui_ImplWin32_Init(hwnd);
        ImGui_ImplDX11_Init(g_pd3dDevice, g_pd3dDeviceContext);

        ::c_context context(hwnd);

        gui.initialize(io);

        ::ShowWindow(hwnd, SW_SHOWDEFAULT);
        ::UpdateWindow(hwnd);


        bool done = false;
        while (!done) {
            MSG msg;
            while (::PeekMessage(&msg, NULL, 0U, 0U, PM_REMOVE)) {
                ::TranslateMessage(&msg);
                ::DispatchMessage(&msg);
                if (msg.message == WM_QUIT)
                    done = true;
            }
            if (done)
                break;


            if (g_SwapChainOccluded && g_pSwapChain->Present(0, DXGI_PRESENT_TEST) == DXGI_STATUS_OCCLUDED) {
                ::Sleep(10);
                continue;
            }
            g_SwapChainOccluded = false;

            if (g_ResizeWidth != 0 && g_ResizeHeight != 0) {
                CleanupRenderTarget();
                g_pSwapChain->ResizeBuffers(0, g_ResizeWidth, g_ResizeHeight, DXGI_FORMAT_UNKNOWN, 0);
                g_ResizeWidth = g_ResizeHeight = 0;
                CreateRenderTarget();
            }

            {
                ::c_frame frame{};

                RECT rect;
                GetWindowRect(hwnd, &rect);

                if (GImGui->MovingWindow != NULL) {
                    MoveWindow(hwnd,
                        static_cast<int>(rect.left + ImGui::GetMouseDragDelta().x),
                        static_cast<int>(rect.top + ImGui::GetMouseDragDelta().y),
                        static_cast<int>(ui::size.x),
                        static_cast<int>(ui::size.y),
                        TRUE);

                }

                gui.render();

            }
        }

        ImGui_ImplDX11_Shutdown();
        ImGui_ImplWin32_Shutdown();
        ImGui::DestroyContext();
    }

    CleanupDeviceD3D();

    ::DestroyWindow(hwnd);

    auto unregisterClassName = xorstr(L"dmwhgckrakyzkopfccjbxgzwlplrzftp");
    ::UnregisterClassW(unregisterClassName.crypt_get(), wc.hInstance);

    return 0;
    VMProtectEnd();
}